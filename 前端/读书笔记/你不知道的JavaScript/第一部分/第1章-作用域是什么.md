## 作用域是什么

### 1.1 编译原理

> 前言

- javascript是一门编译语言，javascript引擎进行编译的步骤和传统的编译语言非常相似。
- 传统编译语言执行一段源代码之前会经历三个步骤：分词/词法分析、解析/语法分析、代码生成。

> 分词/词法分析

- 这个过程会将由字符组成的字符串分解成(对编程语言来说)有意义的代码块，即`词法单元`。
- 空格是否被当做词法单元，取决于空格在这门语言中是否具有意义。例如`python`。

> 解析/语法分析

- 过程：将词法单元流（数组）转换成`AST(抽象语法树)`

> 代码生成

- 将`AST`转换为可执代码的过程。

> JavaSript引擎比以上步骤要更为复杂

- 在词法分析、代码生成阶段会有特定的步骤来对运行性能进行优化，但不会应用大量的时间。

- 大部分情况下编译发生在代码执行前的`几微妙（甚至更短）`的时间内。


### 1.2 理解作用域

> 引擎

- 从头到尾负责整个JavaScript程序的编译及执行过程。

> 编译器

- 负责语法分析及代码生成（引擎运行时所需的代码）等。
- 编译器可以在代码生成的同时处理声明和值的定义。

> 作用域

- 负责收集并维护所有声明的标记符组成的一系列查询，并且实施一套严格的规则，确保当前执行的代码对这些标记符的访问权限。

- 编译和引擎运行过程都会涉及与作用域之间的`交流`。

- 变量的赋值操作`var a = 2`：
  `编译器`在当前作用域查找`a`，如果找到则忽略继续进行编译；如果没有找到，则在当前作用域中声明一个新的变量，命名为`a`。编译器最终生成引擎运行时所需的代码。
  `引擎`运行时会首先询问当前`作用域`中是否会存在叫`a`的变量，如果是，则使用这个变量。否则继续查找。
  最终找到变量`a`，并将`2`赋值给它。

- 引擎的查找方式分为`LHS查询`和`RHS查询`，当变量出现在赋值操作的左侧时进行`LHS`查询，非左侧进行`RHS`查询。`LHS 查询`试图找到变量的容器本身，从而可以对其赋值。`RHS查询`可以理解成取到它的`源值`。


### 1.4 异常

- 如果`RHS`查询在所有嵌套作用域中遍寻不到所需的变量，引擎会抛出`ReferenceError`的异常。

- 当`LHS`查询在`全局作用域`中也无法找到目标变量，全局作用域中就会创建一个具有该名称的变量，并将其返回给引擎（非严格模式下），如果`严格模式`下也会抛出`ReferenceError`。

- 如果`RHS`找到了一个变量，但你对其进行不合理的操作，引擎将会抛出`TypeError`。

- `ReferenceError `同作用域判别失败相关，而 `TypeError` 则代表作用域判别成功了，但是对结果的操作是非法或不合理的。


  			
  		
  	

​			