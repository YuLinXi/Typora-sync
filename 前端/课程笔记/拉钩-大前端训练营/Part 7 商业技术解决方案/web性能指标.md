# Web 性能指标 

## 性能模型

### RAIL性能模型

*RAIL* 是 `Response`、`Animation`、`Idle`、`Load`的首字母组成和。由 *Google Chrome*团队于
2015年提出的性能模型。  

理念：以用户为中心，最终目标不是让您的网站在 **任何** 特定的设备上都能运行很快，而是使用户 **满意**。

1. 响应（Response）：应该尽可能快速的响应用于，应该在 **100ms** 以内响应用户输入。注，并非要响应结果，而是能在这个时间内给予用户 **反馈** 。
2. 动画（Animation）：在展示动画的时候，每一帧应该以 **16ms** 以内 **【最好10ms）** 进行渲染，这样可以保持动画效果的一致性，并且避免卡顿。
3. 空闲（Idle）：当使用 **Javascript主线程** 的时候，应该把任务划分到执行时间小于 **50ms** 的片段中去，这样可以释放线程以进行用户交互。
4. 加载（Load）：首次加载应该在小于 **5s** 的时间加载完成你的网站，并可以进行用户交互。 

在移动端等慢速网络环境下，加载 **5s** 是一个更现实的目标。在高速网络环境下如（PC）在 **1s** 以内完成加载。

#### RAIL性能指标

[基于用户体验的性能指标](https://web.dev/metrics)是Chrome在web.dev提出的。

**FCP（First Contentful Paint）**  

浏览器首次绘制来自DOM的内容的时间。内容必须包含（文本、图片、非白色的Canvas或SVG，也包括Web字体文本）。并不意味着有用户要消费的内容（比如通过Ajax根据用户拉取的特定内容）。

| FCP时间（单位S） | 颜色编码     | FCP分数  |
| ---------------- | ------------ | -------- |
| 0-2              | 绿色（快速） | 75 - 100 |
| 2-4              | 橙色（中等） | 50-74    |
| > 4              | 红色（慢）   | 0-49     |

[优化方案](https://web.dev/fcp/#fcp-4)

**LCP（Largest Contentful Paint）**

最大内容绘制，可视区域中**最大的内容元素呈现到屏幕上**的时间，用于估算页面的主要内容对用户可见时间。

LCP考虑的元素

1. \<img\> 元素
2. \<image>元素内的\<svg\>元素
3. \<video\>元素
4. 通过`url()`函数加载背景图片的元素
5. 包含文本节点或其他内联级文本元素子级**块级**元素

为了提供良好的用户体验，网站应该力争**2.5秒或更短**的`最大绘画内容`。

| LCP时间（单位S） | 颜色编码     |
| ---------------- | ------------ |
| 0-2.5            | 绿色（快速） |
| 2.5-4            | 橙色（中等） |
| > 4              | 红色（慢）   |

[优化方案](https://web.dev/lcp/#lcp-4)

**FID（First Input Delay）**. 

首次输入延迟，从用户**第一次与页面交互**（例如点击链接、按钮、输入等）到浏览器**实际能够响应**该交互的时间。

| FID时间（单位mS） | 颜色编码     |
| ----------------- | ------------ |
| 9 -100            | 绿色（快速） |
| 100 - 300         | 橙色（中等） |
| > 300             | 红色（慢）   |

[优化方案](https://web.dev/fid/#fid-6)

**TTI（Time to Interactive）**

网页第一次**完全达到可交互状态**的时间点。该状态在最后一个**长任务完成的时间**，并且随后的5秒内网络和主线程是空闲的。

「长任务」：需要50毫秒以上才能完成的任务

| TTI时间（单位S） | 颜色编码     |
| ---------------- | ------------ |
| 0-3.8            | 绿色（快速） |
| 3.9-7.3          | 橙色（中等） |
| > 7.3            | 红色（慢）   |

[优化方案](https://web.dev/tti/#tti-4)

**TBT（Total Block Time）**

总阻塞时间，度量了 **FCP** 和 **TTI** 之间的总时间。

| TBT时间（单位ms） | 颜色编码     |
| ----------------- | ------------ |
| 0-300             | 绿色（快速） |
| 300-600           | 橙色（中等） |
| > 600             | 红色（慢）   |

[优化方案](https://web.dev/tbt/#tbt-4)

**CLS（Cumulative Layout Shift）**

累计布局便宜，CLS会测量在页面 **整个生命周期** 中发生的每个 **意外的布局移位** 的所有单独布局移位分数的总和。它是一种 **保证页面视觉稳定性** 而提升用户体验的指标方案。

| CLS时间（单位ms） | 颜色编码     |
| ----------------- | ------------ |
| 0-0.1             | 绿色（快速） |
| 0.1-0.25          | 橙色（中等） |
| > 0.25            | 红色（慢）   |

[优化方案](https://web.dev/cls/#cls-4)


### Web Vitals性能模型

也是Google Chrome团队提出，简化**RAIL性能模型** 用于衡量网站的用户体验。

其核心指标为：**LCP**、**FID**、**CLS**

#### 测量 Web Vitals

- 性能测试工具，比如`Lighthouse`
- 使用`web-vitals`库
- 使用浏览器插件`Web Vitals`

优化 Web Vitals 即优化 `LCP`、`FID`、`CLS`三项指标

## 性能测试 

### Lighthouse 工具

1. 在 `Chrome DevTools`中使用
2. 使用`Chrome`扩展
3. 使用 `Node CLI`命令行。
4. 使用`Node`包
5. ...

[指标与分数的比例](https://googlechrome.github.io/lighthouse/scorecalc/)

### WebPageTest 工具

更强大的在线测试工具，[在线网址](https://www.webpagetest.org)

### Chrome DevTools 测试工具

