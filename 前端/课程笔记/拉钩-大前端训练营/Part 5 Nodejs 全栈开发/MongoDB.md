# MongoDB

## 什么是MongoDB

- MongoDB 由 C++ 语言编写，是一个基于 **分布式文件存储** 的开源 **NoSQL** 数据库系统。
- MongoDB 是非关系数据库中功能最丰富，最像 **关系数据库** 的数据库。
- MongoDB将数据存储为一个文档（类似JSON对象）,数据结构由 **键值对** 组成。
- MongoDB的查询功能非常强大：不仅支持大部分关系数据库中的**单表查询**，还支持**范围查询**、**排序**、**聚合**、**MapReduce**等。

## MongoDB特点

- 文档型数据库
- 高性能：支持使用签入数据时，减少系统 **I/O负担** ，支持 **子文档查询** 。
- 灵活性
- 高可用、水平扩展：支持 **副本集** 与 **分片**
- 强大的查询语言：多种查询类型支持，且支持数据 **聚合查询**、**文本检索**、**地址位置查询**
- 多种存储引擎：**WiredTiger**、**In-Memory**

4.0版本推出ACID事务支持，成为第一个 **支持强事务** 的NoSQL数据库。

## 适用场景

1. 需要处理 **大量** 的 **低价值** 数据，且对数据处理要求**高性能**。
   例如：微博数据的处理。不需要太高事务性但对性能要求很高。

2. 需要借助 **缓存层** 来处理数据。
   因为MongoDB能高效的处理数据，所以非常适合缓存层来使用。
   将MongoDB作为持久化缓存层，可以避免底层储存的资源过载。
   例如：用户登录后的Session信息存储到MongoDB中。
  
3. 需要高度的 **伸缩性** 。
   当使用关系型数据库的表大小达到一定数量级后，其性能会急剧下降。
   使用多台MongoDB服务器搭建一个集群环境，实现最大程度的扩展，且不影响性能。

## 版本号注意事项

MongoDB版本号采用 **X.Y.Z** 的形式，例如4.4.2。
如果Y是 **奇数**，则为 **开发版本**，建议开发测试使用。
如果Y是 **偶数**，则为 **稳定版**，建议生成环境使用。

## MongoDB服务启停

命名启动服务端

```shell
# 使用默认存储目录/data/db
# 需要提前手动创建。
mongod

# 指定数据存储目录
mongod -dbpath="数据库目录"
```

命令启动客户端连接服务端。

```shell
# 本地
mongo --port 28015

# 远程主机
mongo --host mongodb.example.com:28015

# 远程主机连接字符串
mongo "mongodb://alisd@test.com:28015/?authSource=admin"
```

MongoDB 默认占用端口 **27017**。

## MongoDB基础概念

### 数据库
#### 数据存储结构

数据以 **JSON** 格式存储。

#### 数据库名称规则

1. 不区分大小写，但是**建议全部小写**。
2. 不能包含空格字符。
3. 数据库名称不能为空，并且必须**少于64个字符**。
4. windows不能包括：`/\. "$*,.:|?` 中的任何字符。
5. Unix和Linux不能包括：`/\. "$`中的任何字符。

### 集合

集合类似于关系数据库中的**表**，MongoDB将文档存储在集合中。


#### 集合名称规则

集合名词以**下划线**或**字母字符**开头，并且：
1. 不能包含 `$`。
2. 不能为空或包含字符串。
3. 不能以`.`开头
4. 长度限制：
   1. 版本4.2最大120字节。
   2. 版本4.4最大255字节。


#### 创建

```js
// 插入数据时自动创建集合
db.hello.insert({ name: "1" });

// 显示创建具有各种选项的集合
db.createCollection();
```

#### 查看

```shell

show collections
```

#### 删除

```js

db.集合名称.drop()
```

### 文档

MongoDB将数据记录存储为 **BSON文档**。
BSON（Binary JSON）文档：是JSON文档的 **二进制** 表现形式，它比JSON包含更多的数据类型。

#### 文档结构

```json
{
  field1: value1,
  field2: value2,
  ....
}
```